<?php

namespace Tests\Feature;

use Illuminate\Support\Facades\Http;
use Tests\TestCase;

class NewYorkTimesControllerTest extends TestCase
{
    public function test_nyt_controller_incorrect_api_version(): void
    {
        $response = $this->get('/api/7/nyt/best-sellers');
        $response->assertStatus(404);
    }

    public function test_nyt_controller_and_service_response(): void
    {
        Http::fake([
            'api.nytimes.com/*' => Http::response(null, 200),
        ]);

        $response = $this->get('/api/1/nyt/best-sellers');
        $response->assertStatus(200);
    }

    public function test_nyt_controller_validations(): void
    {
        Http::fake([
            'api.nytimes.com/*' => Http::response('[]', 200),
        ]);

        //Incorrect
        $response = $this->get('/api/1/nyt/best-sellers?author=' . $this->getRandLetters(300));
        $response->assertStatus(422);

        $response = $this->get('/api/1/nyt/best-sellers?isbn[0]=' . $this->getRandLetters(2));
        $response->assertStatus(422);

        $response = $this->get('/api/1/nyt/best-sellers?isbn[0]=' . $this->getRandLetters(14));
        $response->assertStatus(422);

        $response = $this->get('/api/1/nyt/best-sellers?title=' . $this->getRandLetters(300));
        $response->assertStatus(422);

        $response = $this->get('/api/1/nyt/best-sellers?offset=1');
        $response->assertStatus(422);

        $response = $this->get('/api/1/nyt/best-sellers?offset=45');
        $response->assertStatus(422);

        //Correct
        $response = $this->get('/api/1/nyt/best-sellers?author=' . $this->getRandLetters(10));
        $response->assertStatus(200);

        $response = $this->get('/api/1/nyt/best-sellers?isbn[0]=' . $this->getRandLetters(10));
        $response->assertStatus(200);

        $response = $this->get('/api/1/nyt/best-sellers?isbn[0]=' . $this->getRandLetters(13));
        $response->assertStatus(200);

        $response = $this->get('/api/1/nyt/best-sellers?title=' . $this->getRandLetters(200));
        $response->assertStatus(200);

        $response = $this->get('/api/1/nyt/best-sellers?offset=0');
        $response->assertStatus(200);

        $response = $this->get('/api/1/nyt/best-sellers?offset=400');
        $response->assertStatus(200);
    }

    public function test_nyt_controller_empty_response(): void
    {
        $resp = '{
            "status": "OK",
            "copyright": "Copyright (c) 2023 The New York Times Company.  All Rights Reserved.",
            "num_results": 0,
            "results": []
        }';
        Http::fake([
            'api.nytimes.com/*' => Http::response($resp, 200),
        ]);

        $response = $this->get('/api/1/nyt/best-sellers?offset=0');
        $response->assertStatus(200);
        $response->assertExactJson([]);
    }

    public function test_nyt_controller_fine_response(): void
    {
        $resp = '{"status":"OK","copyright":"Copyright (c) 2023 The New York Times Company.  All Rights Reserved.","num_results":13,"results":[{"title":"A PROMISED LAND","description":"In the first volume of his presidential memoirs, Barack Obama offers personal reflections on his formative years and pivotal moments through his first term. Read by the author. 29 hours, 10 minutes unabridged.","contributor":"by Barack Obama","author":"Barack Obama","contributor_note":"","price":"0.00","age_group":"","publisher":"Random House Audio","isbns":[{"isbn10":"1524763160","isbn13":"9781524763169"},{"isbn10":"1524763187","isbn13":"9781524763183"},{"isbn10":"0525633715","isbn13":"9780525633716"},{"isbn10":"0593239040","isbn13":"9780593239049"}],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"AMERICAN GROWN","description":"The story of the White House kitchen garden and gardens across the country.","contributor":"by Michelle Obama","author":"Michelle Obama","contributor_note":"","price":"30.00","age_group":"","publisher":"Crown","isbns":[{"isbn10":"0307956024","isbn13":"9780307956026"}],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"BARACK OBAMA IN HIS OWN WORDS","description":"","contributor":"by Barack Obama. Edited by Lisa Rogak","author":"Barack Obama","contributor_note":"Edited by Lisa Rogak","price":"0.00","age_group":"","publisher":"PublicAffairs","isbns":[],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"BECOMING","description":"The former first lady describes her journey from the South Side of Chicago to the White House, and how she balanced work, family and her husband\u2019s political ascent.","contributor":"by Michelle Obama","author":"Michelle Obama","contributor_note":"","price":"0.00","age_group":"","publisher":"Crown","isbns":[{"isbn10":"1524763136","isbn13":"9781524763138"},{"isbn10":"0525633677","isbn13":"9780525633679"},{"isbn10":"1524763144","isbn13":"9781524763145"}],"ranks_history":[],"reviews":[{"book_review_link":"https:\/\/www.nytimes.com\/2018\/12\/06\/books\/review\/michelle-obama-becoming-memoir.html","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"BECOMING: ADAPTED FOR YOUNG READERS","description":"A memoir of the former first lady.","contributor":"by Michelle Obama","author":"Michelle Obama","contributor_note":"","price":"0.00","age_group":"","publisher":"Delacorte","isbns":[{"isbn10":"0593303741","isbn13":"9780593303740"}],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"CHANGE HAS COME","description":"Drawings inspired by the 44th president.","contributor":"with words by Barack Obama. Illustrated by Kadir Nelson.","author":"with words  Barack Obama","contributor_note":"Illustrated by Kadir Nelson.","price":"12.99","age_group":"All ages","publisher":"Simon & Schuster","isbns":[],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"CHANGE WE CAN BELIEVE IN","description":"Speeches and policy proposals from Obama\u2019s presidential campaign.","contributor":"with a foreword by Barack Obama","author":"with a foreword  Barack Obama","contributor_note":"","price":"13.95","age_group":"","publisher":"Three Rivers","isbns":[],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"DREAMS FROM MY FATHER","description":"Stories on life as the son of a Black African father and a white American mother by the man who would become the 44th president of the United States; originally published in 1995.","contributor":"by Barack Obama","author":"Barack Obama","contributor_note":"","price":"0.00","age_group":"","publisher":"Crown","isbns":[{"isbn10":"1400082773","isbn13":"9781400082773"},{"isbn10":"0307383415","isbn13":"9780307383419"}],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"https:\/\/www.nytimes.com\/1995\/08\/06\/books\/review\/06obama-dreams.html","article_chapter_link":""}]},{"title":"OF THEE I SING","description":"The president speaks of heroes in a letter to his daughters.","contributor":"by Barack Obama. Illustrated by Loren Long","author":"Barack Obama","contributor_note":"Illustrated by Loren Long","price":"17.99","age_group":"Ages 5 to 8","publisher":"Knopf","isbns":[{"isbn10":"037583527X","isbn13":"9780375835278"}],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":"http:\/\/thecaucus.blogs.nytimes.com\/2010\/09\/14\/obama-writes-childrens-book\/"}]},{"title":"RENEGADES","description":"Conversations between the 44th president and the multiple award-winning musician on a range of topics.","contributor":"by Barack Obama and Bruce Springsteen","author":"Barack Obama and Bruce Springsteen","contributor_note":"","price":"0.00","age_group":"","publisher":"Crown","isbns":[{"isbn10":"0593236319","isbn13":"9780593236314"},{"isbn10":"0593236327","isbn13":"9780593236321"}],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"THE AUDACITY OF HOPE","description":"The Illinois senator proposes that Americans move beyond their political divisions.","contributor":"by Barack Obama","author":"Barack Obama","contributor_note":"","price":"14.95","age_group":"","publisher":"Three Rivers","isbns":[{"isbn10":"0307455874","isbn13":"9780307455871"}],"ranks_history":[],"reviews":[{"book_review_link":"https:\/\/www.nytimes.com\/2006\/10\/17\/books\/17kaku.html","first_chapter_link":"https:\/\/www.nytimes.com\/2006\/12\/24\/books\/chapters\/1224-1st-obama.html","sunday_review_link":"https:\/\/www.nytimes.com\/2006\/12\/24\/books\/review\/Hart.t.html","article_chapter_link":""}]},{"title":"THE INAUGURAL ADDRESS 2009","description":"Obama\u2019s Inaugural Address as well as two by Lincoln, the Gettysburg Address and an Emerson essay.","contributor":"by Barack Obama","author":"Barack Obama","contributor_note":"","price":"12.00","age_group":"","publisher":"Penguin","isbns":[],"ranks_history":[],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]},{"title":"THE LIGHT WE CARRY","description":"The former first lady shares personal stories and the tools she uses to deal with difficult situations.","contributor":"by Michelle Obama","author":"Michelle Obama","contributor_note":"","price":"0.00","age_group":"","publisher":"Crown","isbns":[{"isbn10":"0593237463","isbn13":"9780593237465"},{"isbn10":"0593237471","isbn13":"9780593237472"},{"isbn10":"0593677889","isbn13":"9780593677889"},{"isbn10":"0593677870","isbn13":"9780593677872"}],"ranks_history":[{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":6,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-04-02","bestsellers_date":"2023-03-18","weeks_on_list":18,"rank_last_week":6,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":8,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-04-02","bestsellers_date":"2023-03-18","weeks_on_list":18,"rank_last_week":7,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":7,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-03-26","bestsellers_date":"2023-03-11","weeks_on_list":17,"rank_last_week":6,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":6,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-03-26","bestsellers_date":"2023-03-11","weeks_on_list":17,"rank_last_week":4,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":4,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-03-19","bestsellers_date":"2023-03-04","weeks_on_list":16,"rank_last_week":4,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":6,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-03-19","bestsellers_date":"2023-03-04","weeks_on_list":16,"rank_last_week":5,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":4,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-03-12","bestsellers_date":"2023-02-25","weeks_on_list":15,"rank_last_week":2,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":5,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-03-12","bestsellers_date":"2023-02-25","weeks_on_list":15,"rank_last_week":6,"asterisk":0,"dagger":0},{"primary_isbn10":"0593677889","primary_isbn13":"9780593677889","rank":5,"list_name":"Audio Nonfiction","display_name":"Audio Nonfiction","published_date":"2023-03-12","bestsellers_date":"2023-02-25","weeks_on_list":0,"rank_last_week":0,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":6,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-03-05","bestsellers_date":"2023-02-18","weeks_on_list":14,"rank_last_week":5,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":2,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-03-05","bestsellers_date":"2023-02-18","weeks_on_list":14,"rank_last_week":4,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":4,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-02-26","bestsellers_date":"2023-02-11","weeks_on_list":13,"rank_last_week":5,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":5,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-02-26","bestsellers_date":"2023-02-11","weeks_on_list":13,"rank_last_week":7,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":5,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-02-19","bestsellers_date":"2023-02-04","weeks_on_list":12,"rank_last_week":4,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":7,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-02-19","bestsellers_date":"2023-02-04","weeks_on_list":12,"rank_last_week":5,"asterisk":0,"dagger":0},{"primary_isbn10":"0593677889","primary_isbn13":"9780593677889","rank":2,"list_name":"Audio Nonfiction","display_name":"Audio Nonfiction","published_date":"2023-02-12","bestsellers_date":"2023-01-28","weeks_on_list":0,"rank_last_week":0,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":4,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-02-12","bestsellers_date":"2023-01-28","weeks_on_list":11,"rank_last_week":2,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":5,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-02-12","bestsellers_date":"2023-01-28","weeks_on_list":11,"rank_last_week":2,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":2,"list_name":"Combined Print and E-Book Nonfiction","display_name":"Combined Print & E-Book Nonfiction","published_date":"2023-02-05","bestsellers_date":"2023-01-21","weeks_on_list":10,"rank_last_week":2,"asterisk":0,"dagger":0},{"primary_isbn10":"0593237463","primary_isbn13":"9780593237465","rank":2,"list_name":"Hardcover Nonfiction","display_name":"Hardcover Nonfiction","published_date":"2023-02-05","bestsellers_date":"2023-01-21","weeks_on_list":10,"rank_last_week":2,"asterisk":0,"dagger":0}],"reviews":[{"book_review_link":"","first_chapter_link":"","sunday_review_link":"","article_chapter_link":""}]}]}';
        $apiResp = '[{"title":"A PROMISED LAND","description":"In the first volume of his presidential memoirs, Barack Obama offers personal reflections on his formative years and pivotal moments through his first term. Read by the author. 29 hours, 10 minutes unabridged.","contributor":"by Barack Obama","author":"Barack Obama","contributorNote":"","price":0,"ageGroup":"","publisher":"Random House Audio","isbns":[{"isbn10":"1524763160","isbn13":"9781524763169"},{"isbn10":"1524763187","isbn13":"9781524763183"},{"isbn10":"0525633715","isbn13":"9780525633716"},{"isbn10":"0593239040","isbn13":"9780593239049"}],"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"AMERICAN GROWN","description":"The story of the White House kitchen garden and gardens across the country.","contributor":"by Michelle Obama","author":"Michelle Obama","contributorNote":"","price":30,"ageGroup":"","publisher":"Crown","isbns":[{"isbn10":"0307956024","isbn13":"9780307956026"}],"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"BARACK OBAMA IN HIS OWN WORDS","description":"","contributor":"by Barack Obama. Edited by Lisa Rogak","author":"Barack Obama","contributorNote":"Edited by Lisa Rogak","price":0,"ageGroup":"","publisher":"PublicAffairs","isbns":null,"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"BECOMING","description":"The former first lady describes her journey from the South Side of Chicago to the White House, and how she balanced work, family and her husband\u2019s political ascent.","contributor":"by Michelle Obama","author":"Michelle Obama","contributorNote":"","price":0,"ageGroup":"","publisher":"Crown","isbns":[{"isbn10":"1524763136","isbn13":"9781524763138"},{"isbn10":"0525633677","isbn13":"9780525633679"},{"isbn10":"1524763144","isbn13":"9781524763145"}],"ranksHistory":null,"reviews":[{"bookReviewLink":"https:\/\/www.nytimes.com\/2018\/12\/06\/books\/review\/michelle-obama-becoming-memoir.html","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"BECOMING: ADAPTED FOR YOUNG READERS","description":"A memoir of the former first lady.","contributor":"by Michelle Obama","author":"Michelle Obama","contributorNote":"","price":0,"ageGroup":"","publisher":"Delacorte","isbns":[{"isbn10":"0593303741","isbn13":"9780593303740"}],"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"CHANGE HAS COME","description":"Drawings inspired by the 44th president.","contributor":"with words by Barack Obama. Illustrated by Kadir Nelson.","author":"with words  Barack Obama","contributorNote":"Illustrated by Kadir Nelson.","price":12.99,"ageGroup":"All ages","publisher":"Simon & Schuster","isbns":null,"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"CHANGE WE CAN BELIEVE IN","description":"Speeches and policy proposals from Obama\u2019s presidential campaign.","contributor":"with a foreword by Barack Obama","author":"with a foreword  Barack Obama","contributorNote":"","price":13.95,"ageGroup":"","publisher":"Three Rivers","isbns":null,"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"DREAMS FROM MY FATHER","description":"Stories on life as the son of a Black African father and a white American mother by the man who would become the 44th president of the United States; originally published in 1995.","contributor":"by Barack Obama","author":"Barack Obama","contributorNote":"","price":0,"ageGroup":"","publisher":"Crown","isbns":[{"isbn10":"1400082773","isbn13":"9781400082773"},{"isbn10":"0307383415","isbn13":"9780307383419"}],"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"https:\/\/www.nytimes.com\/1995\/08\/06\/books\/review\/06obama-dreams.html","articleChapterLink":""}]},{"title":"OF THEE I SING","description":"The president speaks of heroes in a letter to his daughters.","contributor":"by Barack Obama. Illustrated by Loren Long","author":"Barack Obama","contributorNote":"Illustrated by Loren Long","price":17.99,"ageGroup":"Ages 5 to 8","publisher":"Knopf","isbns":[{"isbn10":"037583527X","isbn13":"9780375835278"}],"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":"http:\/\/thecaucus.blogs.nytimes.com\/2010\/09\/14\/obama-writes-childrens-book\/"}]},{"title":"RENEGADES","description":"Conversations between the 44th president and the multiple award-winning musician on a range of topics.","contributor":"by Barack Obama and Bruce Springsteen","author":"Barack Obama and Bruce Springsteen","contributorNote":"","price":0,"ageGroup":"","publisher":"Crown","isbns":[{"isbn10":"0593236319","isbn13":"9780593236314"},{"isbn10":"0593236327","isbn13":"9780593236321"}],"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"THE AUDACITY OF HOPE","description":"The Illinois senator proposes that Americans move beyond their political divisions.","contributor":"by Barack Obama","author":"Barack Obama","contributorNote":"","price":14.95,"ageGroup":"","publisher":"Three Rivers","isbns":[{"isbn10":"0307455874","isbn13":"9780307455871"}],"ranksHistory":null,"reviews":[{"bookReviewLink":"https:\/\/www.nytimes.com\/2006\/10\/17\/books\/17kaku.html","firstChapterLink":"https:\/\/www.nytimes.com\/2006\/12\/24\/books\/chapters\/1224-1st-obama.html","sundayReviewLink":"https:\/\/www.nytimes.com\/2006\/12\/24\/books\/review\/Hart.t.html","articleChapterLink":""}]},{"title":"THE INAUGURAL ADDRESS 2009","description":"Obama\u2019s Inaugural Address as well as two by Lincoln, the Gettysburg Address and an Emerson essay.","contributor":"by Barack Obama","author":"Barack Obama","contributorNote":"","price":12,"ageGroup":"","publisher":"Penguin","isbns":null,"ranksHistory":null,"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]},{"title":"THE LIGHT WE CARRY","description":"The former first lady shares personal stories and the tools she uses to deal with difficult situations.","contributor":"by Michelle Obama","author":"Michelle Obama","contributorNote":"","price":0,"ageGroup":"","publisher":"Crown","isbns":[{"isbn10":"0593237463","isbn13":"9780593237465"},{"isbn10":"0593237471","isbn13":"9780593237472"},{"isbn10":"0593677889","isbn13":"9780593677889"},{"isbn10":"0593677870","isbn13":"9780593677872"}],"ranksHistory":[{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":6,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-04-02","bestsellersDate":"2023-03-18","weeksOnList":18,"rankLastWeek":6,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":8,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-04-02","bestsellersDate":"2023-03-18","weeksOnList":18,"rankLastWeek":7,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":7,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-03-26","bestsellersDate":"2023-03-11","weeksOnList":17,"rankLastWeek":6,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":6,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-03-26","bestsellersDate":"2023-03-11","weeksOnList":17,"rankLastWeek":4,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":4,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-03-19","bestsellersDate":"2023-03-04","weeksOnList":16,"rankLastWeek":4,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":6,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-03-19","bestsellersDate":"2023-03-04","weeksOnList":16,"rankLastWeek":5,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":4,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-03-12","bestsellersDate":"2023-02-25","weeksOnList":15,"rankLastWeek":2,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":5,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-03-12","bestsellersDate":"2023-02-25","weeksOnList":15,"rankLastWeek":6,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593677889","primaryIsbn13":"9780593677889","rank":5,"listName":"Audio Nonfiction","displayName":"Audio Nonfiction","publishedDate":"2023-03-12","bestsellersDate":"2023-02-25","weeksOnList":0,"rankLastWeek":0,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":6,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-03-05","bestsellersDate":"2023-02-18","weeksOnList":14,"rankLastWeek":5,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":2,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-03-05","bestsellersDate":"2023-02-18","weeksOnList":14,"rankLastWeek":4,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":4,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-02-26","bestsellersDate":"2023-02-11","weeksOnList":13,"rankLastWeek":5,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":5,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-02-26","bestsellersDate":"2023-02-11","weeksOnList":13,"rankLastWeek":7,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":5,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-02-19","bestsellersDate":"2023-02-04","weeksOnList":12,"rankLastWeek":4,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":7,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-02-19","bestsellersDate":"2023-02-04","weeksOnList":12,"rankLastWeek":5,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593677889","primaryIsbn13":"9780593677889","rank":2,"listName":"Audio Nonfiction","displayName":"Audio Nonfiction","publishedDate":"2023-02-12","bestsellersDate":"2023-01-28","weeksOnList":0,"rankLastWeek":0,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":4,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-02-12","bestsellersDate":"2023-01-28","weeksOnList":11,"rankLastWeek":2,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":5,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-02-12","bestsellersDate":"2023-01-28","weeksOnList":11,"rankLastWeek":2,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":2,"listName":"Combined Print and E-Book Nonfiction","displayName":"Combined Print & E-Book Nonfiction","publishedDate":"2023-02-05","bestsellersDate":"2023-01-21","weeksOnList":10,"rankLastWeek":2,"asterisk":0,"dagger":0},{"primaryIsbn10":"0593237463","primaryIsbn13":"9780593237465","rank":2,"listName":"Hardcover Nonfiction","displayName":"Hardcover Nonfiction","publishedDate":"2023-02-05","bestsellersDate":"2023-01-21","weeksOnList":10,"rankLastWeek":2,"asterisk":0,"dagger":0}],"reviews":[{"bookReviewLink":"","firstChapterLink":"","sundayReviewLink":"","articleChapterLink":""}]}]';
        Http::fake([
            'api.nytimes.com/*' => Http::response($resp, 200),
        ]);

        $response = $this->get('/api/1/nyt/best-sellers?author=Obama');
        $response->assertStatus(200);
        $response->assertExactJson(json_decode($apiResp, true));
    }

    private function getRandLetters($length)
    {
        $stringSpace = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
        $stringLength = strlen($stringSpace);
        $randomString = '';
        for ($i = 0; $i < $length; $i ++) {
            $randomString = $randomString . $stringSpace[rand(0, $stringLength - 1)];
        }

        return $randomString;
    }
}
